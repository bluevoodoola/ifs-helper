<!DOCTYPE html>
<html>

<head>
    <title>Ingress First Saturday Stats QR Generator</title>

    <link rel="stylesheet" type="text/css" href="styles.css" />

    <script type="text/javascript" src="js/ingress/definitions.js"></script>
    <script type="text/javascript" src="js/ingress/stats.js"></script>

    <script type="text/javascript">
        function create(text) {
            if ( text != '' ) {
                var stats = GetAgentStats(text);
                var data = JSON.stringify(FilterStatsForIFS(stats));

                document.getElementById("qrimage").innerHTML = "<img src='https://chart.googleapis.com/chart?chs=500x500&cht=qr&chl=" + encodeURIComponent(data) + "&chld=H'/>";

                document.getElementById("AgentName").innerText = stats.username;
                document.getElementById("Faction").innerText = FactionTranslation.find(e => e.AgentStatsName === stats.faction).NianticName;
                document.getElementById("Faction").style.color = FactionTranslation.find(e => e.AgentStatsName === stats.faction).color;
                document.getElementById("Level").innerText = stats.level;
                document.getElementById("LifetimeAP").innerText = stats.lifetimeap.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById("CurrentAP").innerText = stats.ap.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById("Trekker").innerText = stats.trekker.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById("Recursions").innerText = stats.recursions;

                document.querySelectorAll('.watching-stats').forEach(el => { el.dataset.stats = "stats-present" ; });
            }
        }

        function reset() {
            document.getElementById("rawdata").value = '';
            document.querySelectorAll('.watching-stats').forEach(el => { el.dataset.stats = "stats-waiting" ; });
        }
    </script>
</head>

<body onload="reset()">
    <div id="main">
        <div id="mainbody">
            <table border="0" align="center">
                <tr>
                    <td align="center">
                        <textarea cols="40" rows="10" id="rawdata" class="watching-stats"></textarea>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <button id="create" onclick="create(document.getElementById('rawdata').value)" class="watching-stats">Create</button>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <div id="qrimage" class="watching-stats">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <div id="stats" class="watching-stats">
                            <table align="center">
                                <tr>
                                    <td>Agent Name</td>
                                    <td><span id="AgentName"></span></td>
                                </tr>
                                <tr>
                                    <td>Faction</td>
                                    <td><span id="Faction"></span></td>
                                </tr>
                                <tr>
                                    <td>Level</td>
                                    <td><span id="Level"></span></td>
                                </tr>
                                <tr>
                                    <td>Recursions</td>
                                    <td><span id="Recursions"></span></td>
                                </tr>
                                <tr>
                                    <td rowspan="2">AP</td>
                                    <td style="text-align : right;"><span id="CurrentAP"></span></td>
                                    <td>Current</td>
                                </tr>
                                <tr>
                                    <td style="text-align : right;"><span id="LifetimeAP"></span></td>
                                    <td>Lifetime</td>
                                </tr>
                                <tr>
                                    <td>Trekker</td>
                                    <td style="text-align : right;"><span id="Trekker"></span></td>
                                    <td>km</td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <button id="reset" onclick="reset()" class="watching-stats">Reset</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>

</html>